"use client"

import { useState } from "react"
import { useMode } from "@/contexts/mode-context"
import BottomNav from "@/components/bottom-nav"

// Responder Views
import MissionView from "@/components/mission-view"
import IncidentsView from "@/components/incidents-view"
import CommsView from "@/components/comms-view"
import TeamView from "@/components/team-view"
import ProfileView from "@/components/profile-view"

// User Views
import UserHome from "@/components/user/user-home"
import ReportIncident from "@/components/user/report-incident"
import NearbyAlerts from "@/components/user/nearby-alerts"
import UserProfile from "@/components/user/user-profile"

export default function FieldResponderApp() {
  const { mode } = useMode()
  const [activeTab, setActiveTab] = useState(mode === "user" ? "home" : "mission")
  const [preSelectedType, setPreSelectedType] = useState<string | undefined>(undefined)
  const [activeIncident, setActiveIncident] = useState<any>(null)

  const handleNavigateToReport = (type: string) => {
    setPreSelectedType(type)
    setActiveTab("report")
  }

  const handleIncidentSubmitted = (incidentData: any) => {
    // Create active incident with mock data
    const newIncident = {
      id: `INC-${Math.floor(Math.random() * 10000)}`,
      type: incidentData.type,
      status: "dispatched",
      eta: "4 min",
      responderName: "Officer Sarah Chen",
      location: "Connaught Place, Delhi",
      reportedAt: new Date().toISOString()
    }

    setActiveIncident(newIncident)

    // Navigate back to home after a short delay to show the success popup
    setTimeout(() => {
      setActiveTab("home")
    }, 3000)
  }

  const renderUserView = () => {
    switch (activeTab) {
      case "home":
        return <UserHome onNavigateToReport={handleNavigateToReport} activeIncident={activeIncident} />
      case "report":
        return <ReportIncident preSelectedType={preSelectedType} onSubmit={handleIncidentSubmitted} />
      case "alerts":
        return <NearbyAlerts />
      case "profile":
        return <UserProfile />
      default:
        return <UserHome onNavigateToReport={handleNavigateToReport} activeIncident={activeIncident} />
    }
  }

  const renderResponderView = () => {
    switch (activeTab) {
      case "mission":
        return <MissionView />
      case "incidents":
        return <IncidentsView />
      case "comms":
        return <CommsView />
      case "team":
        return <TeamView />
      case "profile":
        return <ProfileView />
      default:
        return <MissionView />
    }
  }

  return (
    <div className="min-h-screen bg-background text-foreground w-full">
      {/* Mobile viewport container - responsive for all screen sizes */}
      <div className="flex flex-col h-screen w-full bg-background overflow-hidden max-w-[430px] mx-auto px-2">
        {/* Main content area */}
        <div className="flex-1 overflow-hidden">
          {mode === "user" ? renderUserView() : renderResponderView()}
        </div>

        {/* Bottom Navigation */}
        <BottomNav activeTab={activeTab} onTabChange={setActiveTab} mode={mode} />
      </div>
    </div>
  )
}




